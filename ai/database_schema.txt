BEGIN;


CREATE TABLE IF NOT EXISTS public."CompetitionFishCatches"
(
    "Id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "CompetitionId" integer NOT NULL,
    "ParticipantId" integer NOT NULL,
    "JudgeId" integer NOT NULL,
    "SpeciesName" character varying(255) COLLATE pg_catalog."default" NOT NULL,
    "LengthCm" numeric(6, 2),
    "WeightKg" numeric(7, 3),
    "PhotoUrl" text COLLATE pg_catalog."default" NOT NULL,
    "CatchTime" timestamp with time zone NOT NULL,
    "Created" timestamp with time zone NOT NULL,
    "CreatedBy" integer,
    "LastModified" timestamp with time zone NOT NULL,
    "LastModifiedBy" integer,
    CONSTRAINT "PK_CompetitionFishCatches" PRIMARY KEY ("Id")
);

CREATE TABLE IF NOT EXISTS public."CompetitionParticipants"
(
    "Id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "CompetitionId" integer NOT NULL,
    "UserId" integer,
    "GuestName" text COLLATE pg_catalog."default",
    "GuestIdentifier" text COLLATE pg_catalog."default",
    "Role" integer NOT NULL,
    "AddedByOrganizer" boolean NOT NULL,
    "Created" timestamp with time zone NOT NULL,
    "CreatedBy" integer,
    "LastModified" timestamp with time zone NOT NULL,
    "LastModifiedBy" integer,
    CONSTRAINT "PK_CompetitionParticipants" PRIMARY KEY ("Id")
);

CREATE TABLE IF NOT EXISTS public."Competitions"
(
    "Id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "Name" character varying(255) COLLATE pg_catalog."default" NOT NULL,
    "StartTime" timestamp with time zone NOT NULL,
    "EndTime" timestamp with time zone NOT NULL,
    "LocationText" text COLLATE pg_catalog."default",
    "RulesText" text COLLATE pg_catalog."default",
    "Type" integer NOT NULL,
    "Status" integer NOT NULL,
    "ImageUrl" text COLLATE pg_catalog."default",
    "ResultsToken" character varying(64) COLLATE pg_catalog."default" NOT NULL,
    "OrganizerId" integer NOT NULL,
    "MainScoringCategoryId" integer,
    "Created" timestamp with time zone NOT NULL,
    "CreatedBy" integer,
    "LastModified" timestamp with time zone NOT NULL,
    "LastModifiedBy" integer,
    CONSTRAINT "PK_Competitions" PRIMARY KEY ("Id")
);

CREATE TABLE IF NOT EXISTS public."FishSpecies"
(
    "Id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "Name" character varying(255) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT "PK_FishSpecies" PRIMARY KEY ("Id")
);

CREATE TABLE IF NOT EXISTS public."FishSpeciesFishery"
(
    "DefinedSpeciesId" integer NOT NULL,
    "FisheriesId" integer NOT NULL,
    CONSTRAINT "PK_FishSpeciesFishery" PRIMARY KEY ("DefinedSpeciesId", "FisheriesId")
);

CREATE TABLE IF NOT EXISTS public."Fisheries"
(
    "Id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "Name" character varying(255) COLLATE pg_catalog."default" NOT NULL,
    "LocationText" text COLLATE pg_catalog."default",
    "ImageUrl" text COLLATE pg_catalog."default",
    "UserId" integer,
    "Created" timestamp with time zone NOT NULL,
    "CreatedBy" integer,
    "LastModified" timestamp with time zone NOT NULL,
    "LastModifiedBy" integer,
    CONSTRAINT "PK_Fisheries" PRIMARY KEY ("Id")
);

CREATE TABLE IF NOT EXISTS public."LogbookEntries"
(
    "Id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "UserId" integer NOT NULL,
    "SpeciesName" character varying(255) COLLATE pg_catalog."default" NOT NULL,
    "LengthCm" numeric(6, 2),
    "WeightKg" numeric(7, 3),
    "PhotoUrl" text COLLATE pg_catalog."default" NOT NULL,
    "CatchTime" timestamp with time zone NOT NULL,
    "Notes" text COLLATE pg_catalog."default",
    "FisheryId" integer,
    "Created" timestamp with time zone NOT NULL,
    "CreatedBy" integer,
    "LastModified" timestamp with time zone NOT NULL,
    "LastModifiedBy" integer,
    CONSTRAINT "PK_LogbookEntries" PRIMARY KEY ("Id")
);

CREATE TABLE IF NOT EXISTS public."ScoringCategoryOptions"
(
    "Id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "Name" text COLLATE pg_catalog."default" NOT NULL,
    "Description" text COLLATE pg_catalog."default",
    CONSTRAINT "PK_ScoringCategoryOptions" PRIMARY KEY ("Id")
);

CREATE TABLE IF NOT EXISTS public."SpecialCompetitionCategories"
(
    "Id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "Name" text COLLATE pg_catalog."default" NOT NULL,
    "Description" text COLLATE pg_catalog."default",
    "CompetitionId" integer NOT NULL,
    CONSTRAINT "PK_SpecialCompetitionCategories" PRIMARY KEY ("Id")
);

CREATE TABLE IF NOT EXISTS public."Users"
(
    "Id" integer NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    "ClerkUserId" text COLLATE pg_catalog."default" NOT NULL,
    "Name" character varying(255) COLLATE pg_catalog."default" NOT NULL,
    "Email" character varying(255) COLLATE pg_catalog."default",
    "Created" timestamp with time zone NOT NULL,
    "CreatedBy" integer,
    "LastModified" timestamp with time zone NOT NULL,
    "LastModifiedBy" integer,
    CONSTRAINT "PK_Users" PRIMARY KEY ("Id")
);

CREATE TABLE IF NOT EXISTS public."__EFMigrationsHistory"
(
    "MigrationId" character varying(150) COLLATE pg_catalog."default" NOT NULL,
    "ProductVersion" character varying(32) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);

ALTER TABLE IF EXISTS public."CompetitionFishCatches"
    ADD CONSTRAINT "FK_CompetitionFishCatches_CompetitionParticipants_ParticipantId" FOREIGN KEY ("ParticipantId")
    REFERENCES public."CompetitionParticipants" ("Id") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS "IX_CompetitionFishCatches_ParticipantId"
    ON public."CompetitionFishCatches"("ParticipantId");


ALTER TABLE IF EXISTS public."CompetitionFishCatches"
    ADD CONSTRAINT "FK_CompetitionFishCatches_Competitions_CompetitionId" FOREIGN KEY ("CompetitionId")
    REFERENCES public."Competitions" ("Id") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS "IX_CompetitionFishCatches_CompetitionId"
    ON public."CompetitionFishCatches"("CompetitionId");


ALTER TABLE IF EXISTS public."CompetitionFishCatches"
    ADD CONSTRAINT "FK_CompetitionFishCatches_Users_JudgeId" FOREIGN KEY ("JudgeId")
    REFERENCES public."Users" ("Id") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE RESTRICT;
CREATE INDEX IF NOT EXISTS "IX_CompetitionFishCatches_JudgeId"
    ON public."CompetitionFishCatches"("JudgeId");


ALTER TABLE IF EXISTS public."CompetitionParticipants"
    ADD CONSTRAINT "FK_CompetitionParticipants_Competitions_CompetitionId" FOREIGN KEY ("CompetitionId")
    REFERENCES public."Competitions" ("Id") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public."CompetitionParticipants"
    ADD CONSTRAINT "FK_CompetitionParticipants_Users_UserId" FOREIGN KEY ("UserId")
    REFERENCES public."Users" ("Id") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE SET NULL;
CREATE INDEX IF NOT EXISTS "IX_CompetitionParticipants_UserId"
    ON public."CompetitionParticipants"("UserId");


ALTER TABLE IF EXISTS public."Competitions"
    ADD CONSTRAINT "FK_Competitions_ScoringCategoryOptions_MainScoringCategoryId" FOREIGN KEY ("MainScoringCategoryId")
    REFERENCES public."ScoringCategoryOptions" ("Id") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;
CREATE INDEX IF NOT EXISTS "IX_Competitions_MainScoringCategoryId"
    ON public."Competitions"("MainScoringCategoryId");


ALTER TABLE IF EXISTS public."Competitions"
    ADD CONSTRAINT "FK_Competitions_Users_OrganizerId" FOREIGN KEY ("OrganizerId")
    REFERENCES public."Users" ("Id") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS "IX_Competitions_OrganizerId"
    ON public."Competitions"("OrganizerId");


ALTER TABLE IF EXISTS public."FishSpeciesFishery"
    ADD CONSTRAINT "FK_FishSpeciesFishery_FishSpecies_DefinedSpeciesId" FOREIGN KEY ("DefinedSpeciesId")
    REFERENCES public."FishSpecies" ("Id") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;


ALTER TABLE IF EXISTS public."FishSpeciesFishery"
    ADD CONSTRAINT "FK_FishSpeciesFishery_Fisheries_FisheriesId" FOREIGN KEY ("FisheriesId")
    REFERENCES public."Fisheries" ("Id") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS "IX_FishSpeciesFishery_FisheriesId"
    ON public."FishSpeciesFishery"("FisheriesId");


ALTER TABLE IF EXISTS public."Fisheries"
    ADD CONSTRAINT "FK_Fisheries_Users_UserId" FOREIGN KEY ("UserId")
    REFERENCES public."Users" ("Id") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;
CREATE INDEX IF NOT EXISTS "IX_Fisheries_UserId"
    ON public."Fisheries"("UserId");


ALTER TABLE IF EXISTS public."LogbookEntries"
    ADD CONSTRAINT "FK_LogbookEntries_Fisheries_FisheryId" FOREIGN KEY ("FisheryId")
    REFERENCES public."Fisheries" ("Id") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE SET NULL;
CREATE INDEX IF NOT EXISTS "IX_LogbookEntries_FisheryId"
    ON public."LogbookEntries"("FisheryId");


ALTER TABLE IF EXISTS public."LogbookEntries"
    ADD CONSTRAINT "FK_LogbookEntries_Users_UserId" FOREIGN KEY ("UserId")
    REFERENCES public."Users" ("Id") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS "IX_LogbookEntries_UserId"
    ON public."LogbookEntries"("UserId");


ALTER TABLE IF EXISTS public."SpecialCompetitionCategories"
    ADD CONSTRAINT "FK_SpecialCompetitionCategories_Competitions_CompetitionId" FOREIGN KEY ("CompetitionId")
    REFERENCES public."Competitions" ("Id") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS "IX_SpecialCompetitionCategories_CompetitionId"
    ON public."SpecialCompetitionCategories"("CompetitionId");

END;